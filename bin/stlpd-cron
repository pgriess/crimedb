#!/bin/env bash
#
# Cronjob to periodically download STLPD data and update Solr

WORKDIR=$(mktemp -d)

cleanup() {
    rm -fr $WORKDIR
}

trap cleanup EXIT

find $1 -iname '*.csv' >$WORKDIR/before
$(dirname $0)/stlpd-download $1
find $1 -iname '*.csv' >$WORKDIR/after

for fn in $(cat $WORKDIR/after) ; do
    if grep -q $fn $WORKDIR/before ; then
        continue
    fi

    echo "Adding $fn ..."
    $(dirname $0)/stlpd-import $fn
done
